function grandTotal(){var t=0,e=0;$(".productQnt").each(function(){t+=Number($(this).val()),e+=1}),$(".totalItemAndQnt").html(e+" ("+t+")");var a=0;$(".subtotalCol").each(function(){a+=Number($(this).html())}),$(".totalAmount").html(a.toFixed(2));var o=$("#orderDiscountValue").val(),r=calculateDiscount(a,o);$(".totalOrderDiscountAmount").html("(-) "+(a-r).toFixed(2));var s=0;if($("#tariffCharges > .row").each(function(){var t=$(this).closest(".row").find(".tariffChargesName").val().split(": ")[1],e=calculatetarifCharges(r,t);$(this).closest(".row").find(".tariffChargesAmount").val(e),s+=Number(e)}),$(".totalTariffChargesAmount").html("(+) "+s.toFixed(2)),!0===$("#payment").hasClass("in")){if(!1===$("#shippingCharge").is(":focus")&&($("#totalPackets").is(":focus")||$("#packetShippingRate").is(":focus"))){var i=$("#totalPackets").val()*$("#packetShippingRate").val();$("#shippingCharge").val(i)}}else{var l=0;$(".productPacket").each(function(){l+=Number($(this).val())}),$(".displayTotalPackets").html(l.toFixed(2)),$("#totalPackets").val(Math.round(l));i=$("#totalPackets").val()*$("#packetShippingRate").val();$("#shippingCharge").val(i)}var c=(Number(s)+Number(r)).toFixed(2);$(".netTotalAmount").html(c),$("#finalizeSale > tbody > tr:nth-child(1) > td:nth-child(2)").html(c);var d=Number($("#paidAmount").val()),n=Number($("#shippingCharge").val()),u=Number(c)+n,p=u<d?d-u:0,m=u>d?u-d:0;$("#finalizeSale > tbody > tr:nth-child(3) > td:nth-child(2)").html(u.toFixed(2)),$("#finalizeSale > tbody > tr:nth-child(5) > td:nth-child(2)").html(p.toFixed(2)),$("#finalizeSale > tbody > tr:nth-child(6) > td:nth-child(2)").html(m.toFixed(2)),$("#quickPayableAmount").html(Math.round(u))}function calculateDiscount(t,e=null){return""===e||null===e||"null"===e||0===e?Number(t).toFixed(2):e.indexOf("%")>0?(Number(t)-Number(e.replace("%",""))/100*Number(t)).toFixed(2):(Number(t)-Number(e)).toFixed(2)}function calculatetarifCharges(t,e=null){return null===e||"null"===e||0===e?0:e.indexOf("%")>0?(Number(e.replace("%",""))/100*Number(t)).toFixed(2):Number(e).toFixed(2)}function disableEnableWCSelect(){$(".productQnt").length>0?$("#customers, #warehouse").prop("disabled",!0):$("#customers, #warehouse").prop("disabled",!1)}function editProductItemDetails(t,e){$("#productSaleDetails .modal-title").html(e),$("#productSaleDetails .product_id").val(t);var a=$("tr#pid"+t);$("#productSaleDetails #productSaleItemPrice").val(a.find(".netSalesPrice").val()),$("#productSaleDetails #productSaleItemDiscount").val(a.find(".productDiscount").val()),$("#productSaleDetails #productSaleItemPacket").val(a.find(".productPacket").val()),$("#productSaleDetails #productSaleItemDetails").val(a.find(".productItemDetails").val())}$(function(){$.ajax({url:full_website_address+"/info/?module=data&page=productList",success:function(t,e){var a=JSON.parse(t);if(null!=a){var o="";a.forEach(t=>{var e=full_website_address;t.v&&t.v>0?e+="/images/?for=products&id="+t.id+"&q=YTozOntzOjI6Iml3IjtpOjIwMDtzOjI6ImloIjtpOjIyMDtzOjI6ImlxIjtpOjcwO30=&v="+t.v:e+="/assets/images/noimage.png",o+="<button type='button' value='"+t.id+"' title='"+t.name+"' data-toggle='tooltip' class='productButton btn-product btn-default'> <img src='"+e+"' style='width:60px; height:60px;' alt='"+t.name+"'> <span> "+t.name+" </span> </button> "}),$("#productListContainer").html(o)}else $("#productListContainer").html("<div class='alert alert-danger'>No products found in this criteria.</div>")}})}),$(document).on("change","#productCategory, #productBrand, #productYears",function(){var t=$("#productCategory").val(),e=$("#productBrand").val(),a=$("#productYears").val();$.ajax({url:full_website_address+"/info/?module=data&page=productList&product_category_id="+t+"&productBrand="+e+"&product_year="+a,success:function(t,e){var a=JSON.parse(t);if(null!=a){var o="";a.forEach(t=>{var e=full_website_address;t.v&&t.v>0?e+="/images/?for=products&id="+t.id+"&q=YTozOntzOjI6Iml3IjtpOjIwMDtzOjI6ImloIjtpOjIyMDtzOjI6ImlxIjtpOjcwO30=&v="+t.v:e+="/assets/images/noimage.png",o+="<button type='button' value='"+t.id+"' title='"+t.name+"' data-toggle='tooltip' class='productButton btn-product btn-default'> <img src='"+e+"' style='width:60px; height:60px;' alt='"+t.name+"'> <span> "+t.name+" </span> </button> "}),$("#productListContainer").html(o)}else $("#productListContainer").html("<div class='alert alert-danger'>No products found in this criteria.</div>")}})}),$(document).on("change","#warehouse, #customers",function(){var t=$("#customers").val(),e=$("#warehouse").val();$("#customersId").val(t),$("#warehouseId").val(e)}),$(function(){var t=$("#customers").val(),e=$("#warehouse").val();$("#customersId").val(t),$("#warehouseId").val(e)}),$(document).on("click","#addProductButton, .productButton",function(){$(this).val()>0&&$("#selectProduct").html("<option value=''>Search Product....</option>");$("#productTable > tbody > tr").length;var t=$("#selectProduct").val()>0?$("#selectProduct").val():$(this).val(),e=$("#warehouseId").val(),a=1;if(""!==t){var o=0;$(".productID").each(function(){$(this).val()===t&&(o+=1,a+=Number($(this).closest("tr").find(".productQnt").val()))}),o>0&&!confirm("The product is already in the list. Do you want to add it again?")||$.ajax({url:full_website_address+"/info/?module=data&page=productDetailsForPos&product_id="+t+"&warehouse_id="+e+"&pqnt="+a,success:function(e,a){if("success"==a){var r=JSON.parse(e);if(void 0!==r.error&&!0===r.error)return void Swal.fire({title:"Error!",text:r.msg,icon:"error",onClose:$("body").css("padding","0px")});var s=0;r.product_packet_quantity>0&&(s=(1/Number(r.product_packet_quantity)).toFixed(2));var i="";r.product_unit_list.forEach(t=>{1==t.puv_default?selectedUnit="selected":selectedUnit="",i+="<option "+selectedUnit+" value='"+t.puv_name+"'>"+t.puv_name+"</option>"});var l=null===r.product_discount?"0%":r.product_discount,c=calculateDiscount(r.product_sale_price,l),d="";if(Number(c)===Number(r.product_sale_price))d=parseFloat(r.product_sale_price).toFixed(2);else d="<span>"+c+"</span><span><del><small>"+parseFloat(r.product_sale_price).toFixed(2)+"</small></del></span>";var n='<tr id="pid'+t+o+'"> <td class="col-md-6"> <span data-toggle="modal" data-target="#modalDefault" href="'+full_website_address+"/xhr/?module=reports&page=totalPurchasedQuantityOfThisCustomer&cid="+$("#customersId").val()+"&pid="+t+'"> <i class="fa fa-info-circle productDescription"></i> </span> <a href="#" data-toggle="modal" onclick="editProductItemDetails('+t+o+", '"+r.product_name+'\')" data-target="#productSaleDetails">'+r.product_name+'</a> </td> <td class="col-md-2 displayProductPrice text-right">'+d+'</td> <td class="col-md-2"><input onclick = "this.select()" type="text" name="productQnt[]" value="1" class="productQnt form-control text-center" autoComplete="off"></td> <td class="col-md-3 text-right"> <select name="productItemUnit[]" class="productItemUnit form-control">'+i+'</select> </td> <td class="col-md-2 subtotalCol text-right">'+c+'</td> <td style="width: 25px; !important"> <i style="cursor: pointer;" class="fa fa-trash-o removeThisProduct"></i> </td> <input type="hidden" name="productID[]" class="productID" value="'+t+'"> <input type="hidden" class="netSalesPrice" name="productSalePirce[]" value="'+parseFloat(r.product_sale_price).toFixed(2)+'"> <input type="hidden" name="productDiscount[]" value="'+l+'" class="productDiscount" autoComplete="off"> <input type="hidden" name="productPacket[]" value="'+s+'" class="productPacket"> <input type="hidden" name="productItemDetails[]" class="productItemDetails" value=""> </tr>';$("#productTable > tbody").append(n),$("tr#pid"+t+o).find(".productQnt").select(),grandTotal(),disableEnableWCSelect()}}})}else alert("Please select a product")}),$(document).on("change",".productItemUnit",function(){var t=$("#warehouseId").val(),e=$(this).closest("tr").find(".productQnt").val(),a=($(this).closest("tr").find(".netSalesPrice").val(),$(this).closest("tr").find(".productDiscount").val()),o=$(this).closest("tr").find("td.subtotalCol"),r=$(this).closest("tr").find(".productID").val(),s=this;$.ajax({url:full_website_address+"/info/?module=data&page=productDetailsForPos&product_id="+r+"&warehouse_id="+t+"&pqnt="+e+"&product_unit="+$(this).val(),success:function(t,r){if("success"==r){var i=JSON.parse(t);void 0!==i.error&&!0===i.error&&($(s).closest("tr").find(".productQnt").val(i.having_item_quantity),e=i.having_item_quantity,Swal.fire({title:"Error!",text:i.msg,icon:"error",onClose:$("body").css("padding","0px")}));var l=calculateDiscount(i.product_sale_price,a),c="";if(Number(l)===Number(i.product_sale_price))c=parseFloat(i.product_sale_price).toFixed(2);else c="<span>"+l+"</span><span><del><small>"+parseFloat(i.product_sale_price).toFixed(2)+"</small></del></span>";$(s).closest("tr").find(".netSalesPrice").val(parseFloat(i.product_sale_price).toFixed(2)),$(s).closest("tr").find(".displayProductPrice").html(c),$(o).html((e*l).toFixed(2)),grandTotal()}}})}),$(document).on("keyup blur",".productQnt",function(){var t=$(this).closest("tr").find(".netSalesPrice").val(),e=$(this).val(),a=$(this).closest("tr").find(".productDiscount").val(),o=$(this).closest("tr").find("td.subtotalCol"),r=$(this).closest("tr").find(".productID").val(),s=$("#warehouseId").val(),i=$(this).closest("tr").find(".productPacket"),l=$(this).closest("tr").find(".productItemUnit").val(),c=this;e<1&&(Swal.fire({title:"Error!",text:"Product qunatity must be at least one",icon:"error",onClose:$("body").css("padding","0px")}),$(this).val(1),e=1),$.ajax({url:full_website_address+"/info/?module=data&page=productDetailsForPos&product_id="+r+"&warehouse_id="+s+"&pqnt="+e+"&product_unit="+l,success:function(r,s){if("success"==s){var l=JSON.parse(r);void 0!==l.error&&!0===l.error&&($(c).val(l.having_item_quantity),e=l.having_item_quantity,Swal.fire({title:"Error!",text:l.msg,icon:"error",onClose:$("body").css("padding","0px")})),$(o).html((calculateDiscount(t,a)*e).toFixed(2));var d=0;Number(l.product_packet_quantity)>0&&(d=(e/Number(l.product_packet_quantity)).toFixed(2)),i.val(d),grandTotal()}}})}),$(document).on("keyup blur",".productPacket",function(){var t=$(this).closest("tr").find(".netSalesPrice").val(),e=$(this).val(),a=$(this).closest("tr").find(".productDiscount").val(),o=$(this).closest("tr").find("td.subtotalCol"),r=$(this).closest("tr").find(".productQnt"),s=$(this).closest("tr").find(".productPacket"),i=$(this).closest("tr").find(".productID").val(),l=$("#warehouseId").val();$.ajax({url:full_website_address+"/info/?module=data&page=productDetailsForPos&product_id="+i+"&warehouse_id="+l+"&packet="+e,success:function(i,l){if("success"==l){var c=JSON.parse(i);if(void 0!==c.error&&!0===c.error){$(r).val(c.having_item_quantity),$(o).html((calculateDiscount(t,a)*c.having_item_quantity).toFixed(2));var d=0;Number(c.product_packet_quantity)>0&&(d=(c.having_item_quantity/Number(c.product_packet_quantity)).toFixed(2)),s.val(d),Swal.fire({title:"Error!",text:c.msg,icon:"error",onClose:$("body").css("padding","0px")})}else{var n=Math.round(Number(c.product_packet_quantity)*e);n>0&&($(r).val(n),$(o).html((calculateDiscount(t,a)*n).toFixed(2)))}grandTotal()}}})}),$(document).on("blur",".productDiscount",function(){var t=$(this).closest("tr").find(".netSalesPrice").val(),e=$(this).closest("tr").find(".productQnt").val(),a=$(this).val(),o=$(this).closest("tr").find("td.subtotalCol");return a.indexOf("%")>1&&a.replace("%","")>=100?(Swal.fire({title:"Error!",text:"Discount Must be below of 100%",icon:"error",onClose:$("body").css("padding","0px")}),void $(this).val("")):Number(a)>=Number(t)&&a.indexOf("%")<1?($(this).val(""),void Swal.fire({title:"Error!",text:"Discount Must be below of product purchase price",icon:"error",onClose:$("body").css("padding","0px")})):($(o).html((calculateDiscount(t,a)*e).toFixed(2)),void grandTotal())}),$(document).on("click",".removeThisProduct",function(){$(this).closest("tr").css("background-color","red").hide("fast",function(){$(this).closest("tr").remove(),grandTotal(),disableEnableWCSelect()})}),$(document).on("blur","#orderDiscountValue",function(){var t=$(".totalAmount").html(),e=$(this).val();return e.indexOf("%")>1&&e.replace("%","")>=100?(Swal.fire({title:"Error!",text:"Discount Must be below of 100%",icon:"error",onClose:$("body").css("padding","0px")}),void $(this).val("")):Number(e)>=Number(t)&&e.indexOf("%")<1?(Swal.fire({title:"Error!",text:"Discount Must be below of product purchase price",icon:"error",onClose:$("body").css("padding","0px")}),void $(this).val("")):void grandTotal()}),$(document).on("click","#addTariffChargesRow",function(){var t='<div class="row"><br/> <div class="col-md-7"> <select name="tariffChargesName[]" class="form-control select2Ajax tariffChargesName" select2-ajax-url="'+full_website_address+'/info/?module=select2&page=tariffCharges"> <option value="">Select Tariff/Charges</option> </select> </div> <div class="col-md-4"> <input type="number" name="tariffChargesAmount[]" class="form-control tariffChargesAmount" step="any"> </div> <div class="col-md-1"> <i style="cursor: pointer; padding-top: 9px;" class="fa fa-trash-o removeThisTariffCharges"></i> </div> </div>';$("#tariffCharges").append(t)}),$(document).on("click",".removeThisTariffCharges",function(){$(this).closest(".row").css("background-color","whitesmoke").hide("fast",function(){$(this).closest(".row").remove(),grandTotal()})}),$(document).on("change",".tariffChargesName",function(){grandTotal()}),$(document).on("keyup","#paidAmount",function(){grandTotal()}),$(document).on("keyup","#shippingCharge",function(){grandTotal()}),$(document).on("keyup blur","#totalPackets, #packetShippingRate",function(){grandTotal()}),$(document).on("submit","form",function(t){t.preventDefault();var e=0;if($(".productQnt").each(function(){e+=Number($(this).val())}),e<1)Swal.fire({title:"Error!",text:"Please add a least one product",icon:"error",onClose:$("body").css("padding","0px")});else{$("#posSubmit").html("Submit &nbsp;&nbsp; <i class='fa fa-spin fa-refresh'></i>");var a=new FormData(this);$.ajax({url:full_website_address+"/info/?module=pos",type:"post",data:a,cache:!1,contentType:!1,processData:!1,success:function(t,e){if("success"==e){$("#posSubmit").html("Submit");var a=JSON.parse(t);"success"===a.saleStatus?window.location.href=full_website_address+"/invoice-print/?autoPrint=true&invoiceType=posSale&msg=Sale successfully completed&id="+a.salesId:$("#posErrorMsg").html('<div class="alert alert-danger">'+a.msg+"</div>")}}})}}),$(document).keydown(function(t){return 113==t.which?($("#salesTariffCharges").modal("show"),!1):114==t.which?($("#orderDiscount").modal("show"),!1):115==t.which?($("#payment").modal("show"),!1):void 0}),$("form").on("keyup keypress",function(t){13===(t.keyCode||t.which)&&!1===$("#payment").hasClass("in")&&(t.preventDefault(),grandTotal(),$("#orderDiscount").hasClass("in")?$("#orderDiscount").modal("hide"):$("#salesTariffCharges").hasClass("in")?$("#salesTariffCharges").modal("hide"):$("#productSaleDetails").hasClass("in")&&$("#productSaleDetails").modal("hide"))}),$(".modal").on("shown.bs.modal",function(){$("#orderDiscountValue, #shippingCharge").select()}),$(document).on("click",".quick-cash",function(){var t=Number($(this).html());$("#paidAmount").val(t),grandTotal()}),$("#productSaleDetails").on("hide.bs.modal",function(){var t=$("#productSaleDetails .product_id").val(),e=$("#productSaleDetails #productSaleItemPrice").val(),a=$("#productSaleDetails #productSaleItemDiscount").val(),o=$("#productSaleDetails #productSaleItemPacket").val(),r=$("#productSaleDetails #productSaleItemDetails").val(),s=$("tr#pid"+t);s.find(".netSalesPrice").val(e);var i=calculateDiscount(e,a),l="";if(Number(i)===Number(e))l=parseFloat(e).toFixed(2);else l="<span>"+i+"</span><span><del><small>"+parseFloat(e).toFixed(2)+"</small></del></span>";s.find(".displayProductPrice").html(l),s.find(".productDiscount").val(a),s.find(".productItemDetails").val(r),s.find(".productPacket").val(o),s.find(".subtotalCol").html(i),grandTotal()}),$(document).on("focus",".productQnt",function(){$(this)[0].scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})}),$("#salesDate").datepicker({format:"yyyy-mm-dd",autoclose:!0});