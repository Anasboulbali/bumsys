function tsd(t){return Number(t).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,")}function sleep(t){return new Promise((e=>setTimeout(e,t)))}function empty(t){return""===t||null===t||"null"===t}function get_options(t){return localStorage.getItem(t)}function to_money(t,e=null,a="",o="",n="",i=""){n=empty(n)?get_options("currencySymbol"):n,i=empty(i)?get_options("currencySymbolPosition"):i;var l=format_number(t,e,a,o);return l="right"===i.toLowerCase?l+" "+n:n+" "+l}function format_number(t,e=null,a="",o=""){t=Number(t),e=empty(e)?get_options("decimalPlaces"):e,a=empty(a)?get_options("decimalSeparator"):a,o=empty(o)?get_options("thousandSeparator"):o;var n="\\d(?=(\\d{3})+"+(e>0?"\\D":"$")+")",i=t.toFixed(Math.max(0,~~e));return(a?i.replace(".",a):i).replace(new RegExp(n,"g"),"$&"+(o||","))}function getPurchaseProductList(t,e){$("#showPurchaseList").hide(),$("#showPurchaseProductList").show(),BMS.fn.get(`customerPurchaseProductList&saleid=${t}`,(t=>{var a="";t.forEach((t=>{a+=`<li style="cursor: pointer" \n onClick="BMS.POS.addReturnProduct(\n '${t.pid}', \n '${t.pn}', \n '${t.pg}', \n '${t.batch}', \n '${t.pu}', \n '${t.hed}',\n '${t.stock_item_discount}', \n '${t.stock_item_price}', \n '${t.stock_item_qty}', \n '${t.stock_item_subtotal}'\n )" class="item">\n <a href="javascript:void(0)" class="product-title">${t.pn}\n <span style="font-size: 12px;" class="label label-success pull-right"> <i class="fa fa-undo"></i> </span>\n <span class="product-description">\n ${t.stock_item_qty}${null===t.pu?"":t.pu} @ ${to_money(t.stock_item_price)}\n </span>\n </a>\n </li>`})),$(".saleReferenceShow").html(`<p style="font-size: 14px; font-weight: bold;">Product list for: ${e}</p>`),$("#showPurchaseProductList ul").html(a)}))}function backToPurchaseList(){$("#showPurchaseList").show(),$("#showPurchaseProductList").hide()}function isJson(t){try{JSON.parse(t)}catch(t){return!1}return!0}function sumInputs(t){var e=0;return $(t).each((function(){e+=""===$(this).val()?0:parseFloat($(this).val())})),e}function disableInput(t,e=!0){$(t).find("input, select, button, textarea").not("[disabled]").addClass("disableInput"),$(".disableInput").prop("disabled",e)}function ajaxFormSubmit(t,e=!1){$("body").toggleClass("wait");var a=$(t).find(":submit"),o=$(a).html();$(a).html(o+" &nbsp;&nbsp; <i class='fa fa-spin fa-refresh'></i>");var n=$(t).attr("action"),i=$(t).attr("method"),l=new FormData(t);disableInput(t);var r=t;$.ajax({url:n,type:i,data:l,cache:!1,contentType:!1,processData:!1,success:function(t,n){if("success"==n){if(isJson(t)){var i=JSON.parse(t);for(var l in i)sweetAlert[l]=i[l];Swal.fire({toast:sweetAlert.toast,position:sweetAlert.position,timer:sweetAlert.timer,showConfirmButton:sweetAlert.showConfirmButton,showCloseButton:sweetAlert.showCloseButton,icon:sweetAlert.icon,title:sweetAlert.title,text:sweetAlert.text,onClose:$("body").css("padding","0px")}),$(".modal.in").modal("hide")}else!0===e&&t.indexOf("danger")<1?(BMS.fn.notify($(t).text()),getContent("./")):void 0===$("#ajaxSubmitMsg").html()?$('<div style="margin-top: 20px; text-align: left;"'+t+"</div>").insertAfter(a).delay(5e3).fadeOut((function(){$(this).remove()})):$("#ajaxSubmitMsg").html(t);disableInput(r,!1),$(a).html(o),$("body").toggleClass("wait"),$("#dataTableWithAjax").length>0&&$("#dataTableWithAjax").DataTable().ajax.reload(null,!1),$("#dataTableWithAjaxExtend").length>0&&$("#dataTableWithAjaxExtend").DataTable().ajax.reload(null,!1)}}})}function sendBulkSMS(t){var e=$("#dataTableWithAjaxExtend").DataTable(),a=e.rows({selected:!0}).indexes(),o=e.cells(a,0).data(),n=[];$.each(o,(function(t,e){""==e&&null==e&&"NULL"==e&&0==e&&"0"==e||n.push(e)})),$("#modalDefault").modal("show").find(".modal-content").load(t+encodeURI(n.join()))}function getContent(t,e=!1){"undefined"!=typeof session&&session.terminate(),window.event&&window.event.ctrlKey||(e&&e.preventDefault(),$(".modal-backdrop.fade.in").remove(),$.get(t+"?contentOnly=true",(function(e,a){defaultiDisplayLength="",$("li").removeClass("active"),window.history.pushState(null,"",t);var o=t,n="Not Found!";void 0!==getPageTitle[o]&&(n=getPageTitle[o]),window.document.title=n,$(".dynamic-container").html(e),jQuery.get(full_website_address+"/assets/js/initiator.min.js")})).fail((function(t){"Not Found"===t.statusText?$(".dynamic-container").html('<div class="content-wrapper">\n <section class="content-header">\n <h1>404 Error Page</h1>\n </section>\n <section class="content">\n <div class="error-page">\n <h2 style="margin-top:0" class="headline text-yellow"> 404</h2>\n <div class="error-content">\n <h3><i class="fa fa-warning text-yellow"></i> Oops! Page not found.</h3>\n <p>We could not find the page you were looking for.</p>\n </div>\n </div>\n </section>\n </div>'):$(".dynamic-container").html('<div class="content-wrapper">\n <section class="content-header">\n <h1>No Internet</h1>\n </section>\n <section class="content">\n <div class="error-page">\n <div class="error-content">\n <h3><i class="fa fa-warning text-red"></i> No Internet</h3>\n <p>Try:</p>\n <ul>\n <li>Checking the network cables, modem, and router</li>\n <li>Reconnecting to Wi-Fi</li>\n <li>Running Network Diagnostics</li>\n </ul>\n </div>\n </div>\n </section>\n </div>')})))}function combosVariations(t,e=0,a=[],o={}){var n=Object.keys(t),i=n[e];return t[i].forEach((l=>{if(o[i]=l,e+1<n.length)combosVariations(t,e+1,a,o);else{var r=JSON.parse(JSON.stringify(o));a.push(r)}})),a}function generateVariation(){var t=[],e=$(".units:checked");e.length>0&&(t.Units=[],$.each(e,(function(e,a){t.Units.push($(a).val())})));var a=$(".editions:checked");a.length>0&&(t.Editions=[],$.each(a,(function(e,a){t.Editions.push($(a).val())})));var o=$(".attribute");if($.each(o,(function(e,a){var o=$(a).find(".attributeName").val(),n=$(a).find("attributeValue, input:checked");n.length>0&&(t[o]=[]),$.each(n,(function(e,a){t[o].push($(a).val())}))})),0===Object.keys(t).length)alert("Please select at least one Attribute.");else{if($(".product-variation-list li").length>0&&!confirm("There already have variations. Do you wish to generate again?"))return;var n=combosVariations(t);console.log(n);var i="",l=(new Date).getTime(),r=$("#productPurchasePrice").val(),s=$("#productSalePrice").val(),c=$("#productDistributorDiscount").val(),d=$("#productWholesalerDiscount").val(),p=$("#productRetailerDiscount").val(),u=$("#productConsumerDiscount").val(),m="1"===$("#productHasExpiryDate").val()?"disabled":"";n.forEach((t=>{var e="",a=[],o=l;l++,$.each(t,(function(t,o){e+=`<input type="hidden" name="product_variation[${t}][]" value="${o}">`,a.push(o)}));var n=a.join("");i+=`<li style="overflow: auto;">\n <div data-toggle="collapse" data-parent=".product-variation-list" href="#variation_${n}" style="cursor: pointer;">\n <input type="radio" name="defaultVariation" value="${o}" class="defaultVariation stopPropagation" data-html="true" data-toggle="tooltip" data-placement="top" data-original-title="Mark this as <br/>default variation">\n <span class="handle">\n <i class="fa fa-ellipsis-v"></i>\n <i class="fa fa-ellipsis-v"></i>\n </span>\n <span class="text">${a.join(", ")}</span>\n <div class="tools">\n <i class="fa fa-edit"></i>\n <i class="fa fa-trash-o removeThisVariation"></i>\n </div>\n </div>\n <div id="variation_${n}" class="panel-collapse collapse">\n ${e}\n <div style="border-top: 1px solid #eee; margin-top: 15px; padding-bottom: 0px;" class="box-body">\n <div class="form-group required col-md-2">\n <label><?php echo __("Code:"); ?></label>\n <input type="text" name="productVariationCode[]" value="${o}" onclick="select()" class="productVariationCode form-control" required>\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Purchase Price"); ?></label>\n <input type="number" name="productVariationPurchasePrice[]" value="${r}" class="form-control productVariationPurchasePrice" step="any">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Sale Price"); ?></label>\n <input type="number" name="productVariationSalePrice[]" value="${s}" class="form-control productVariationSalePrice" step="any">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Distributor Discount:"); ?></label>\n <i data-toggle="tooltip" data-placement="bottom" title="<?php echo __("Percentage or Fixed amount."); ?>" class="fa fa-question-circle"></i>\n <input type="text" name="productDistributorVariationDiscount[]" value="${c}" placeholder="Eg: 10 or 20%" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Wholesaler Discount:"); ?></label>\n <i data-toggle="tooltip" data-placement="bottom" title="<?php echo __("Percentage or Fixed amount."); ?>" class="fa fa-question-circle"></i>\n <input type="text" name="productWholesalerVariationDiscount[]" value="${d}" placeholder="Eg: 10 or 20%" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Retailer Discount:"); ?></label>\n <i data-toggle="tooltip" data-placement="bottom" title="<?php echo __("Percentage or Fixed amount."); ?>" class="fa fa-question-circle"></i>\n <input type="text" name="productRetailerVariationDiscount[]" value="${p}" placeholder="Eg: 10 or 20%" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Consumer Discount:"); ?></label>\n <i data-toggle="tooltip" data-placement="bottom" title="<?php echo __("Percentage or Fixed amount."); ?>" class="fa fa-question-circle"></i>\n <input type="text" name="productConsumerVariationDiscount[]" value="${u}" placeholder="Eg: 10 or 20%" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Initial Stock"); ?></label>\n <i data-toggle="tooltip" data-placement="right" title="Opening or Initial stock of this variation" class="fa fa-question-circle"></i>\n <input ${m} type="number" name="productVariationIntitalStock[]" class="form-control productIntitalStock" step="any">\n </div>\n <div class="form-group col-md-2">\n <label for="productVariationHasSubProduct"><?php echo __("Has sub product?"); ?></label>\n <i data-toggle="tooltip" data-placement="left" title="Select Yes if the variation has sub product." class="fa fa-question-circle"></i>\n <select name="productVariationHasSubProduct[]" id="productVariationHasSubProduct" class="form-control" required>\n <option value="0">No</option>\n <option value="1">Yes</option>\n </select>\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Weight:"); ?></label>\n <input type="text" name="productVariationWeight[]" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Width:"); ?></label>\n <input type="text" name="productVariationWidth[]" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Height:"); ?></label>\n <input type="text" name="productVariationHeight[]" class="form-control">\n </div>\n \n <div class="form-group col-md-6">\n <label><?php echo __("Description:"); ?></label>\n <textarea name="productVariationDescription[]" rows="3" class="form-control"></textarea>\n </div>\n <div class="imageContainer">\n <div class="col-md-3">\n <div class="form-group">\n <label for=""><?php echo __("Variation Photo:"); ?></label>\n <div class="input-group">\n <span class="input-group-btn">\n <span class="btn btn-default btn-file">\n <?php echo __("Select photo"); ?> <input type="file" name="productVariationPhoto[]" class="imageToUpload">\n </span>\n </span>\n <input type="text" class="form-control imageNameShow" readonly>\n </div>\n <div style="margin-top: 8px;" class="photoErrorMessage"></div>\n </div>\n </div>\n <div style="margin-bottom: 5px;" class="form-group col-md-3">\n <div style="height: 120px; text-align: center;" class="image_preview">\n <img style="margin: auto;" class="previewing" width="100%" height="auto" src="" />\n </div>\n </div>\n </div>\n </div>\n </div>\n </li>`})),$(".product-variation-list").append(i)}}function addVariation(){var t=[],e=$(".units:checked");e.length>0&&(t.Units=[],$.each(e,(function(e,a){t.Units.push($(a).val())})));var a=$(".editions:checked");a.length>0&&(t.Editions=[],$.each(a,(function(e,a){t.Editions.push($(a).val())})));var o=$(".attribute");if($.each(o,(function(e,a){var o=$(a).find(".attributeName").val(),n=$(a).find("attributeValue, input:checked");n.length>0&&(t[o]=[]),$.each(n,(function(e,a){t[o].push($(a).val())}))})),0===Object.keys(t).length)alert("Please select at least one Attribute or Unit.");else{var n="";for(let e in t)n+=`<div class="col-md-2 stopPropagation adjustFormGroupPadding"> \n <select style="" name="product_variation[${e}][]" class="form-control" required>`,n+=`<option value="">Select ${e}...</option>`,t[e].forEach((function(t,e){n+=`<option value='${t}'>${t}</option>`})),n+="</select> </div>";var i=(new Date).getTime(),l=$("#productPurchasePrice").val(),r=$("#productSalePrice").val(),s=$("#productDistributorDiscount").val(),c=$("#productWholesalerDiscount").val(),d=$("#productRetailerDiscount").val(),p=$("#productConsumerDiscount").val(),u="1"===$("#productHasExpiryDate").val()?"disabled":"",m=`<li>\n <div data-toggle="collapse" data-parent=".product-variation-list" href="#variation_${i}" style="cursor: pointer;">\n <input type="radio" name="defaultVariation" value="${i}" class="defaultVariation stopPropagation" data-html="true" data-toggle="tooltip" data-placement="top" data-original-title="Mark this as <br/>default variation">\n <span class="handle">\n <i class="fa fa-ellipsis-v"></i>\n <i class="fa fa-ellipsis-v"></i>\n </span>\n <span style="width: 90%; vertical-align: middle; margin-left: 20px;" class="text"> <div class="row">${n}</div> </span>\n <div class="tools">\n <i class="fa fa-edit"></i>\n <i class="fa fa-trash-o removeThisVariation"></i>\n </div>\n </div>\n <div id="variation_${i}" class="panel-collapse collapse in">\n <div style="border-top: 1px solid #eee; margin-top: 15px; padding-bottom: 0px;" class="box-body">\n <div class="form-group required col-md-2">\n <label><?php echo __("Code:"); ?></label>\n <input type="text" name="productVariationCode[]" value="${i}" onclick="select()" class="productVariationCode form-control" required>\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Purchase Price"); ?></label>\n <input type="number" name="productVariationPurchasePrice[]" value="${l}" class="form-control productVariationPurchasePrice" step="any">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Sale Price"); ?></label>\n <input type="number" name="productVariationSalePrice[]" value="${r}" class="form-control productVariationSalePrice" step="any">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Distributor Discount:"); ?></label>\n <i data-toggle="tooltip" data-placement="bottom" title="<?php echo __("Percentage or Fixed amount."); ?>" class="fa fa-question-circle"></i>\n <input type="text" name="productDistributorVariationDiscount[]" value="${s}" placeholder="Eg: 10 or 20%" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Wholesaler Discount:"); ?></label>\n <i data-toggle="tooltip" data-placement="bottom" title="<?php echo __("Percentage or Fixed amount."); ?>" class="fa fa-question-circle"></i>\n <input type="text" name="productWholesalerVariationDiscount[]" value="${c}" placeholder="Eg: 10 or 20%" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Retailer Discount:"); ?></label>\n <i data-toggle="tooltip" data-placement="bottom" title="<?php echo __("Percentage or Fixed amount."); ?>" class="fa fa-question-circle"></i>\n <input type="text" name="productRetailerVariationDiscount[]" value="${d}" placeholder="Eg: 10 or 20%" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Consumer Discount:"); ?></label>\n <i data-toggle="tooltip" data-placement="bottom" title="<?php echo __("Percentage or Fixed amount."); ?>" class="fa fa-question-circle"></i>\n <input type="text" name="productConsumerVariationDiscount[]" value="${p}" placeholder="Eg: 10 or 20%" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Initial Stock"); ?></label>\n <i data-toggle="tooltip" data-placement="right" title="Opening or Initial stock of this variation" class="fa fa-question-circle"></i>\n <input ${u} type="number" name="productVariationIntitalStock[]" class="form-control productIntitalStock" step="any">\n </div>\n <div class="form-group col-md-2">\n <label for="productVariationHasSubProduct"><?php echo __("Has sub product?"); ?></label>\n <i data-toggle="tooltip" data-placement="left" title="Select Yes if the variation has sub product." class="fa fa-question-circle"></i>\n <select name="productVariationHasSubProduct[]" id="productVariationHasSubProduct" class="form-control" required>\n <option value="0">No</option>\n <option value="1">Yes</option>\n </select>\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Weight:"); ?></label>\n <input type="text" name="productVariationWeight[]" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Width:"); ?></label>\n <input type="text" name="productVariationWidth[]" class="form-control">\n </div>\n <div class="form-group col-md-2">\n <label><?php echo __("Height:"); ?></label>\n <input type="text" name="productVariationHeight[]" class="form-control">\n </div>\n \n <div class="form-group col-md-6">\n <label><?php echo __("Description:"); ?></label>\n <textarea name="productVariationDescription[]" rows="3" class="form-control"></textarea>\n </div>\n <div class="imageContainer">\n <div class="col-md-3">\n <div class="form-group">\n <label for=""><?php echo __("Product Photo:"); ?></label>\n <div class="input-group">\n <span class="input-group-btn">\n <span class="btn btn-default btn-file">\n <?php echo __("Select photo"); ?> <input type="file" name="productVariationPhoto[]" class="imageToUpload">\n </span>\n </span>\n <input type="text" class="form-control imageNameShow" readonly>\n </div>\n <div style="margin-top: 8px;" class="photoErrorMessage"></div>\n </div>\n </div>\n <div style="margin-bottom: 5px;" class="form-group col-md-3">\n <div style="height: 120px; text-align: center;" class="image_preview">\n <img style="margin: auto;" class="previewing" width="100%" height="auto" src="" />\n </div>\n </div>\n </div>\n </div>\n </div>\n </li>`;$(".product-variation-list").append(m)}}function setVariationPrice(){var t=$("#productVariationPurchasePriceSetter").val(),e=$("#productVariationSelePriceSetter").val(),a=$("#productVariationDiscountSetter").val(),o=$("#SetPricesWhereUnit").val();""!==o?$.each($(`input[name='product_variation[Units][]'][value='${o}'], select[name='product_variation[Units][]'] option:selected[value='${o}']`),(function(o,n){""!==t&&$(this).closest("li").find(".productVariationPurchasePrice").val(t),""!==e&&$(this).closest("li").find(".productVariationSalePrice").val(e),""!==a&&$(this).closest("li").find(".productVariationDiscount").val(a)})):(""!==t&&$(".productVariationPurchasePrice").val(t),""!==e&&$(".productVariationSalePrice").val(e),""!==a&&$(".productVariationDiscount").val(a))}const showVisualProduct=({category:t="",brand:e="",edition:a="",generic:o="",author:n="",terms:i="",sort:l=""}={})=>{$.ajax({url:full_website_address+`/info/?module=data&page=productVisualList&catId=${t}&brand=${e}&edition=${a}&generic=${o}&author=${n}&terms=${i}&sort=${l}`,contentType:"application/json; charset=utf-8",dataType:"json",success:function(t,e){if(null!==t){var a="";t.forEach((t=>{var e=full_website_address;t.v&&t.v>0?e+="/images/?for=products&id="+t.id+"&q=YTozOntzOjI6Iml3IjtpOjIwMDtzOjI6ImloIjtpOjIyMDtzOjI6ImlxIjtpOjcwO30=&v="+t.v:e+="/assets/images/noimage.png";var o="bg-green";parseInt(t.stock)<=parseInt(t.alert)?o="bg-red":parseInt(t.stock)<=3e3&&(o="bg-orange"),a+=`<div class="col-md-4 col-sm-6 col-xs-12">\n <div class="small-box ${o}">\n <div class="inner">\n <p style="font-size: 20px; font-weight: 600">\n ${t.name}\n </p>\n <p style="font-size: 24px; font-weight: 600; margin: 0;">\n ${format_number(t.sold_qty)} ${t.sold_qty!==t.total_sold_qty?"("+format_number(t.total_sold_qty)+")":""} Sold <br/>\n ${t.stock} Stock\n </p>\n </div>\n <div class="icon">\n <img width='120' src='${e}' >\n </div>\n <a target="_blank" href="${full_website_address}/reports/product-report/?pid=${t.id}" class="small-box-footer"><?= __("View Report "); ?> <i class="fa fa-arrow-circle-right"></i></a>\n </div>\n </div>`})),$("#productVisualListContainer").html(a)}else $("#productVisualListContainer").html("<div class='alert alert-danger'>Sorry! no product found in this criteria.</div>")}})};